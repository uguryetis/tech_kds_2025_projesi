<!DOCTYPE html>
<html lang="tr">
<head>
  <%- include('partials/head') %>
  <script>
    google.charts.load('current', { packages: ['corechart'] });
    google.charts.setOnLoadCallback(drawChart);

    // Ortak yıl ve ay değişkenleri
    var yil = <%= yil %>;
    var seciliAy = <%= seciliAy %>;

    function ayAdi(ay) {
      const adlar = ['', 'Ocak','Şubat','Mart','Nisan','Mayıs','Haziran','Temmuz','Ağustos','Eylül','Ekim','Kasım','Aralık'];
      return adlar[ay] || ay;
    }

    function drawChart() {
      var data = new google.visualization.DataTable();
      data.addColumn('string', 'Şube');
      data.addColumn('number', 'Ciro');
      data.addColumn({ type: 'string', role: 'style' });

      data.addRows([
        <% for (let i = 0; i < ciroData.length; i++) { 
             const row = ciroData[i]; %>
          ['<%= row.sube %>', <%= row.ciro %>, 'color: <%= row.renk %>']<%= i === ciroData.length - 1 ? '' : ',' %>
        <% } %>
      ]);

      var options = {
        title: 'Şube Ciro Analizi - ' + yil + '/' + ayAdi(seciliAy),
        legend: { position: 'none' },
        hAxis: { title: 'Şube' },
        vAxis: {
          title: 'Ciro (₺)',
          format: 'short'
        },
        chartArea: { left: 60, top: 50, width: '80%', height: '65%' }
      };

      var chart = new google.visualization.ColumnChart(document.getElementById('ciroChart'));
      chart.draw(data, options);
    }

    document.addEventListener('DOMContentLoaded', function() {
      const label = document.getElementById('secilenAyLabel');
      if (label) {
        label.textContent = yil + '/' + ayAdi(seciliAy);
      }
    });
  </script>
</head>
<body>
  <div class="wrapper">
    <%- include('partials/nav', { activePage: 'sube-ciro' }) %>

    <main class="main-content">
      <h1 class="page-title">Şube Ciro Analizi</h1>

      <div class="filter-bar">
        <div class="filter-group">
          <label for="ay">Ay Seç</label>
          <form action="/sube-ciro" method="get" style="display:flex; gap:8px;">
            <select name="ay" id="ay">
              <option value="1" <%= seciliAy === 1 ? 'selected' : '' %>>Ocak</option>
              <option value="2" <%= seciliAy === 2 ? 'selected' : '' %>>Şubat</option>
              <option value="3" <%= seciliAy === 3 ? 'selected' : '' %>>Mart</option>
              <option value="4" <%= seciliAy === 4 ? 'selected' : '' %>>Nisan</option>
              <option value="5" <%= seciliAy === 5 ? 'selected' : '' %>>Mayıs</option>
              <option value="6" <%= seciliAy === 6 ? 'selected' : '' %>>Haziran</option>
            </select>
            <button type="submit" class="btn-primary">
              <i class="fa-solid fa-filter"></i>
              Verileri Göster
            </button>
          </form>
        </div>
        <div class="summary-text">
          Seçili Ay:
          <span id="secilenAyLabel"></span> –
          Toplam Ciro:
          ₺<%= Number(toplamCiro || 0).toLocaleString('tr-TR', { minimumFractionDigits:2 }) %>
        </div>
      </div>

      <div class="card-large-chart">
        <div id="ciroChart"></div>
      </div>
    </main>
  </div>
</body>
</html>



