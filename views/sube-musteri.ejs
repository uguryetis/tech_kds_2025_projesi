<!DOCTYPE html>
<html lang="tr">
<head>
  <%- include('partials/head') %>
  <script>
    google.charts.load('current', { packages: ['corechart'] });
    google.charts.setOnLoadCallback(drawChart);

    var yil = <%= yil %>;
    var seciliAy = <%= seciliAy %>;

    function ayAdi(ay) {
      const adlar = ['', 'Ocak','Şubat','Mart','Nisan','Mayıs','Haziran','Temmuz','Ağustos','Eylül','Ekim','Kasım','Aralık'];
      return adlar[ay] || ay;
    }

    function drawChart() {
      var data = new google.visualization.DataTable();
      data.addColumn('string', 'Şube');
      data.addColumn('number', 'Ziyaret');

      data.addRows([
        <% for (let i = 0; i < musteriData.length; i++) {
             const row = musteriData[i]; %>
          ['<%= row.sube %>', <%= row.ziyaret %>]<%= i === musteriData.length - 1 ? '' : ',' %>
        <% } %>
      ]);

      var options = {
        title: 'Şube Bazlı Müşteri Ziyaret Oranları - ' + yil + '/' + ayAdi(seciliAy),
        pieHole: 0.35,
        chartArea: { left: 20, top: 50, width: '60%', height: '70%' },
        legend: { position: 'right' }
      };

      var chart = new google.visualization.PieChart(document.getElementById('musteriChart'));
      chart.draw(data, options);
    }

    document.addEventListener('DOMContentLoaded', function() {
      const label = document.getElementById('secilenAyLabel');
      if (label) {
        label.textContent = yil + '/' + ayAdi(seciliAy);
      }
    });
  </script>
</head>
<body>
  <div class="wrapper">
    <%- include('partials/nav', { activePage: 'sube-musteri' }) %>

    <main class="main-content">
      <h1 class="page-title">Şube Müşteri Analizi</h1>

      <div class="filter-bar">
        <div class="filter-group">
          <label for="ay">Ay Seç</label>
          <form action="/sube-musteri" method="get" style="display:flex; gap:8px;">
            <select name="ay" id="ay">
              <option value="1" <%= seciliAy === 1 ? 'selected' : '' %>>Ocak</option>
              <option value="2" <%= seciliAy === 2 ? 'selected' : '' %>>Şubat</option>
              <option value="3" <%= seciliAy === 3 ? 'selected' : '' %>>Mart</option>
              <option value="4" <%= seciliAy === 4 ? 'selected' : '' %>>Nisan</option>
              <option value="5" <%= seciliAy === 5 ? 'selected' : '' %>>Mayıs</option>
              <option value="6" <%= seciliAy === 6 ? 'selected' : '' %>>Haziran</option>
            </select>
            <button type="submit" class="btn-primary">
              <i class="fa-solid fa-filter"></i>
              Verileri Göster
            </button>
          </form>
        </div>
        <div class="summary-text">
          Seçili Ay:
          <span id="secilenAyLabel"></span> –
          Toplam Ziyaret:
          <%= Number(toplamZiyaret || 0).toLocaleString('tr-TR') %>
        </div>
      </div>

      <div class="card-large-chart">
        <div id="musteriChart"></div>
      </div>
    </main>
  </div>
</body>
</html>



