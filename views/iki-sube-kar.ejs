<!DOCTYPE html>
<html lang="tr">
<head>
  <%- include('partials/head') %>
  <script>
    google.charts.load('current', { packages: ['corechart'] });
    google.charts.setOnLoadCallback(drawChart);

    function ayAdi(ay) {
      const adlar = ['', 'Ocak','Şubat','Mart','Nisan','Mayıs','Haziran'];
      return adlar[ay] || ay;
    }

    function drawChart() {
      var data = new google.visualization.DataTable();
      data.addColumn('string', 'Ay');
      data.addColumn('number', '<%= sube1Ad || "Şube 1" %>');
      data.addColumn('number', '<%= sube2Ad || "Şube 2" %>');

      var aylar = <%- JSON.stringify(aylar || []) %>;
      var sube1Data = <%- JSON.stringify(sube1Karlar || []) %>;
      var sube2Data = <%- JSON.stringify(sube2Karlar || []) %>;

      var rows = [];
      for (var i = 0; i < aylar.length; i++) {
        rows.push([ayAdi(aylar[i]), sube1Data[i] || 0, sube2Data[i] || 0]);
      }

      data.addRows(rows);

      var options = {
        title: 'Ocak–Haziran 2025 İki Şube Kâr Karşılaştırma',
        legend: { position: 'bottom' },
        hAxis: { title: 'Ay' },
        vAxis: { title: 'Kâr (₺)', format: 'short' },
        colors: ['#0ea5e9', '#22c55e'],
        chartArea: { left: 60, top: 50, width: '80%', height: '60%' }
      };

      var chart = new google.visualization.LineChart(document.getElementById('ikiSubeKarChart'));
      chart.draw(data, options);
    }
  </script>
</head>
<body>
  <div class="wrapper">
    <%- include('partials/nav', { activePage: 'iki-sube-kar' }) %>

    <main class="main-content">
      <h1 class="page-title">İki Şube Kâr Karşılaştırma</h1>

      <div class="card" style="margin-bottom: 16px;">
        <form action="/iki-sube-kar" method="get" style="display:flex; flex-wrap:wrap; gap:12px;">
          <div class="filter-group">
            <label for="sube1">1. Şube</label>
            <select name="sube1" id="sube1">
              <% subeList.forEach(s => { %>
                <option value="<%= s.sube_id %>" <%= s.sube_id === sube1Id ? 'selected' : '' %>>
                  <%= s.sube_adi %>
                </option>
              <% }) %>
            </select>
          </div>

          <div class="filter-group">
            <label for="sube2">2. Şube</label>
            <select name="sube2" id="sube2">
              <% subeList.forEach(s => { %>
                <option value="<%= s.sube_id %>" <%= s.sube_id === sube2Id ? 'selected' : '' %>>
                  <%= s.sube_adi %>
                </option>
              <% }) %>
            </select>
          </div>

          <button type="submit" class="btn-primary" style="align-self:flex-end;">
            <i class="fa-solid fa-filter"></i>
            Karşılaştır
          </button>
        </form>
      </div>

      <div class="card-large-chart">
        <div id="ikiSubeKarChart"></div>
      </div>
    </main>
  </div>
</body>
</html>

