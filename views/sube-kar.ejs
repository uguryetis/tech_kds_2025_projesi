<!DOCTYPE html>
<html lang="tr">
<head>
  <%- include('partials/head', { title }) %>
</head>
<body>
  <div class="wrapper">
    <%- include('partials/nav', { activePage }) %>

    <main class="main-content">
      <h1 class="page-title">Şube Kâr Analizi</h1>

      <div class="card">
        <form action="/sube-kar" method="get" class="filter-bar">
          <div class="filter-group">
            <label for="ay">Ay Seç (Aylık Net Kâr)</label>
            <select name="ay" id="ay">
              <% months.forEach((m, idx) => { %>
                <option value="<%= idx+1 %>" <%= (seciliAy === idx+1) ? 'selected' : '' %>>
                  <%= m %>
                </option>
              <% }) %>
            </select>
          </div>
          <button type="submit" class="btn-primary">
            <i class="fa-solid fa-filter"></i>
            Verileri Göster
          </button>
        </form>
      </div>

      <div class="card-large-chart">
        <canvas id="karBarChart"></canvas>
      </div>

      <div class="card-large-chart" style="margin-top: 16px;">
        <canvas id="karLineChart"></canvas>
      </div>
    </main>
  </div>

  <script>
    const barLabels  = <%- JSON.stringify(barLabels) %>;
    const barData    = <%- JSON.stringify(barData) %>;
    const barColors  = <%- JSON.stringify(barColors) %>;
    const lineLabels = <%- JSON.stringify(lineLabels) %>;
    const totalLine  = <%- JSON.stringify(totalLineDataset) %>;

    const ctxBar = document.getElementById('karBarChart').getContext('2d');
    new Chart(ctxBar, {
      type: 'bar',
      data: {
        labels: barLabels,
        datasets: [{
          label: 'Aylık Net Kâr (Milyon TL)',
          data: barData,
          backgroundColor: barColors
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            beginAtZero: true,
            title: { display: true, text: 'Net Kâr (Milyon TL)' }
          }
        },
        plugins: {
          legend: { display: false },
          title: {
            display: true,
            text: 'Seçili Aya Göre Şube Net Kârı'
          }
        }
      }
    });

    const ctxLine = document.getElementById('karLineChart').getContext('2d');
    new Chart(ctxLine, {
      type: 'line',
      data: {
        labels: lineLabels,
        datasets: [totalLine]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            title: { display: true, text: 'Toplam Net Kâr (Milyon TL)' }
          }
        },
        plugins: {
          legend: { position: 'bottom' },
          title: {
            display: true,
            text: 'Ocak - Haziran 2025 Toplam Net Kâr'
          }
        }
      }
    });
  </script>
</body>
</html>





