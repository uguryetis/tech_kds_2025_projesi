<!DOCTYPE html>
<html lang="tr">
<head>
  <%- include('partials/head') %>
</head>
<body>
  <div class="wrapper">
    <%- include('partials/nav', { activePage: 'urunler' }) %>

    <main class="main-content">
      <h1 class="page-title">Ürünler</h1>

      <!-- ÜRÜN İŞLEMLERİ  -->
      <div class="card" style="margin-bottom:16px;">
        <h2 style="font-size:16px; margin-bottom:12px;">Ürün İşlemleri</h2>

        <div style="display:flex; flex-wrap:wrap; gap:24px;">
          <!-- SOL: Yeni Ürün Ekle -->
          <div style="flex:1; min-width:260px;">
            <h3 style="font-size:14px; margin-bottom:8px;">Yeni Ürün Ekle</h3>

            <form action="/urunler/ekle" method="post"
                  style="display:flex; flex-direction:column; gap:8px;">
              <div class="filter-group">
                <label for="urun_adi">Ürün Adı</label>
                <input type="text" id="urun_adi" name="urun_adi" required
                       style="padding:6px 8px; border-radius:8px; border:1px solid #cbd5e1; font-size:13px;">
              </div>
              <div class="filter-group">
                <label for="satis_fiyati">Satış Fiyatı (₺)</label>
                <input type="number" step="0.01" id="satis_fiyati" name="satis_fiyati" required
                       style="padding:6px 8px; border-radius:8px; border:1px solid #cbd5e1; font-size:13px;">
              </div>
              <div class="filter-group">
                <label for="stok">Stok</label>
                <input type="number" id="stok" name="stok" required
                       style="padding:6px 8px; border-radius:8px; border:1px solid #cbd5e1; font-size:13px;">
              </div>

              <button type="submit" class="btn-primary">
                <i class="fa-solid fa-plus"></i>
                Ürün Ekle
              </button>
            </form>
          </div>

          <!-- SAĞ: Mevcut Ürünü Düzenle / Sil -->
          <div style="flex:1; min-width:260px;">
            <h3 style="font-size:14px; margin-bottom:8px;">Mevcut Ürünü Düzenle / Sil</h3>

            <div class="filter-group">
              <label for="urunSec">Ürün Seç</label>
              <select id="urunSec" style="padding:6px 8px; border-radius:8px; border:1px solid #cbd5e1; font-size:13px;">
                <% urunler.forEach(u => { %>
                  <option value="<%= u.urun_id %>">
                    <%= u.urun_adi %> (ID: <%= u.urun_id %>)
                  </option>
                <% }) %>
              </select>
            </div>

            <!-- Güncelleme formu -->
            <form id="urunGuncelleForm" method="post"
                  style="margin-top:10px; display:flex; flex-direction:column; gap:8px;">
              <div class="filter-group">
                <label for="guncel_urun_adi">Ürün Adı</label>
                <input type="text" id="guncel_urun_adi" name="urun_adi"
                       style="padding:6px 8px; border-radius:8px; border:1px solid #cbd5e1; font-size:13px;">
              </div>
              <div class="filter-group">
                <label for="guncel_satis_fiyati">Satış Fiyatı (₺)</label>
                <input type="number" step="0.01" id="guncel_satis_fiyati" name="satis_fiyati"
                       style="padding:6px 8px; border-radius:8px; border:1px solid #cbd5e1; font-size:13px;">
              </div>
              <div class="filter-group">
                <label for="guncel_stok">Stok</label>
                <input type="number" id="guncel_stok" name="stok"
                       style="padding:6px 8px; border-radius:8px; border:1px solid #cbd5e1; font-size:13px;">
              </div>

              <button type="submit" class="btn-primary">
                <i class="fa-regular fa-floppy-disk"></i>
                Güncelle
              </button>
            </form>

            <!-- Silme formu -->
            <form id="urunSilForm" method="post" style="margin-top:8px;">
              <button type="submit" class="btn-icon danger">
                <i class="fa-regular fa-trash-can"></i>
                Seçili Ürünü Sil
              </button>
            </form>
          </div>
        </div>
      </div>

      <!-- ÜRÜN LİSTESİ -->
      <div class="card">
        <h2 style="font-size:16px; margin-bottom:8px;">Ürün Listesi</h2>

        <table class="table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Ürün Adı</th>
              <th>Satış Fiyatı (₺)</th>
              <th>Stok</th>
            </tr>
          </thead>
          <tbody>
            <% urunler.forEach(u => { %>
              <tr>
                <td><%= u.urun_id %></td>
                <td><%= u.urun_adi %></td>
                <td>₺<%= Number(u.satis_fiyati || 0).toLocaleString('tr-TR', { minimumFractionDigits:2 }) %></td>
                <td>
                  <%= u.stok %>
                  <% if (u.stok < 30) { %>
                    <span class="badge-critical">Stok kritik</span>
                  <% } %>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>

      <script>
        const urunlerData = <%- JSON.stringify(urunler || []) %>;

        document.addEventListener('DOMContentLoaded', function () {
          const select = document.getElementById('urunSec');
          const adInput = document.getElementById('guncel_urun_adi');
          const fiyatInput = document.getElementById('guncel_satis_fiyati');
          const stokInput = document.getElementById('guncel_stok');
          const guncelleForm = document.getElementById('urunGuncelleForm');
          const silForm = document.getElementById('urunSilForm');

          function urunBul(id) {
            return urunlerData.find(u => String(u.urun_id) === String(id));
          }

          function formlariGuncelle() {
            const id = select.value;
            if (!id) return;

            guncelleForm.action = '/urunler/guncelle/' + id;
            silForm.action = '/urunler/sil/' + id;

            const u = urunBul(id);
            if (u) {
              adInput.value = u.urun_adi;
              fiyatInput.value = u.satis_fiyati;
              stokInput.value = u.stok;
            }
          }

          formlariGuncelle();
          select.addEventListener('change', formlariGuncelle);
        });
      </script>
    </main>
  </div>
</body>
</html>




